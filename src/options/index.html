<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI 字幕翻譯 - 設定</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div id="options-root">
    <header class="options-header">
      <h1>AI 字幕翻譯設定</h1>
    </header>
    <main class="options-content">
      <section id="provider-section" class="options-section">
        <h2>翻譯服務</h2>
        <div class="provider-selector">
          <label class="provider-option recommended">
            <input type="radio" name="provider" value="google-translate">
            <span class="provider-info">
              <span class="provider-name">Google 翻譯</span>
              <span class="provider-badge free">免費</span>
              <span class="provider-desc">適合一般使用，無需設定</span>
            </span>
          </label>
          <label class="provider-option">
            <input type="radio" name="provider" value="claude-api">
            <span class="provider-info">
              <span class="provider-name">Claude API</span>
              <span class="provider-badge api">API</span>
              <span class="provider-desc">高品質 AI 翻譯，需要 API Key</span>
            </span>
          </label>
          <label class="provider-option">
            <input type="radio" name="provider" value="openai-api">
            <span class="provider-info">
              <span class="provider-name">OpenAI API</span>
              <span class="provider-badge api">API</span>
              <span class="provider-desc">GPT-4 翻譯，需要 API Key</span>
            </span>
          </label>
          <label class="provider-option">
            <input type="radio" name="provider" value="ollama">
            <span class="provider-info">
              <span class="provider-name">Ollama</span>
              <span class="provider-badge local">本地</span>
              <span class="provider-desc">本地運行，完全免費離線使用</span>
            </span>
          </label>
          <label class="provider-option">
            <input type="radio" name="provider" value="claude-subscription">
            <span class="provider-info">
              <span class="provider-name">Claude Pro</span>
              <span class="provider-badge subscription">訂閱</span>
              <span class="provider-desc">使用現有訂閱帳號</span>
            </span>
          </label>
          <label class="provider-option">
            <input type="radio" name="provider" value="chatgpt-subscription">
            <span class="provider-info">
              <span class="provider-name">ChatGPT Plus</span>
              <span class="provider-badge subscription">訂閱</span>
              <span class="provider-desc">使用現有訂閱帳號</span>
            </span>
          </label>
        </div>
      </section>

      <section id="api-key-section" class="options-section hidden">
        <h2 id="api-key-title">API 設定</h2>
        <div class="form-group">
          <label for="api-key">API Key</label>
          <div class="api-key-input-group">
            <input type="password" id="api-key" placeholder="輸入 API Key" autocomplete="off">
            <button id="toggle-key-visibility" class="btn btn-icon" type="button">顯示</button>
          </div>
          <span id="key-status" class="key-status"></span>
        </div>
        <div class="form-group">
          <label for="model-select">模型</label>
          <select id="model-select">
            <option value="">請選擇模型</option>
          </select>
        </div>
        <div class="api-key-actions">
          <button id="validate-key" class="btn btn-secondary">驗證</button>
          <button id="save-api-key" class="btn btn-primary">儲存</button>
          <button id="clear-api-key" class="btn btn-danger">清除</button>
        </div>
      </section>

      <section id="subscription-section" class="options-section hidden">
        <h2 id="subscription-title">訂閱帳號設定</h2>
        
        <!-- OAuth Login (Recommended) -->
        <div class="oauth-section">
          <h3>OAuth 登入</h3>
          <div id="oauth-status" class="oauth-status hidden">
            <span class="status-icon">✓</span>
            已連線
          </div>

          <!-- OAuth Login Button -->
          <div class="oauth-login-section">
            <p class="oauth-desc">點擊下方按鈕使用您的帳號登入：</p>
            <button id="oauth-login" class="btn btn-primary btn-large">
              <span class="btn-icon">🔐</span>
              使用 OAuth 登入
            </button>
          </div>

          <div class="oauth-actions">
            <button id="oauth-validate" class="btn btn-secondary hidden">驗證 Token</button>
            <button id="oauth-logout" class="btn btn-danger hidden">登出</button>
          </div>

          <!-- Manual Token Input (Advanced) -->
          <details class="manual-token-section">
            <summary>手動輸入 Token (進階)</summary>
            <div class="manual-token-content">
              <p class="token-help">
                如果 OAuth 登入失敗，可使用 <code>tools/session-helper</code> 取得 Token：<br>
                <code>python session_helper.py claude -y</code> 或 <code>python session_helper.py chatgpt -y</code>
              </p>
              <div class="form-group">
                <label for="oauth-access-token">Access Token</label>
                <input type="password" id="oauth-access-token" placeholder="貼上 accessToken" autocomplete="off">
              </div>
              <div class="form-group">
                <label for="oauth-refresh-token">Refresh Token (選填)</label>
                <input type="password" id="oauth-refresh-token" placeholder="貼上 refreshToken" autocomplete="off">
              </div>
              <button id="oauth-save-token" class="btn btn-secondary">儲存 Token</button>
            </div>
          </details>
        </div>
        
      </section>

      <section id="ollama-section" class="options-section hidden">
        <h2>Ollama 設定</h2>
        <div class="form-group">
          <label for="ollama-endpoint">端點 URL</label>
          <input type="text" id="ollama-endpoint" placeholder="http://localhost:11434">
          <button id="test-ollama" class="btn">測試連線</button>
        </div>
        <div class="form-group">
          <label for="ollama-model">模型</label>
          <select id="ollama-model">
            <option value="">請選擇模型</option>
          </select>
        </div>
      </section>

      <section id="preferences-section" class="options-section">
        <h2>字幕偏好</h2>
        <div class="form-group">
          <label for="target-language">目標語言</label>
          <select id="target-language">
            <option value="zh-TW">繁體中文</option>
            <option value="zh-CN">簡體中文</option>
            <option value="en">English</option>
          </select>
        </div>
        <div class="form-group">
          <label for="font-size">字體大小</label>
          <input type="range" id="font-size" min="12" max="32" value="18">
          <span id="font-size-value">18px</span>
        </div>
        <div class="form-group">
          <label for="subtitle-position">字幕位置</label>
          <select id="subtitle-position">
            <option value="bottom">底部</option>
            <option value="top">頂部</option>
          </select>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="bilingual-mode">
            雙語模式
          </label>
        </div>
      </section>

      <section id="cache-section" class="options-section">
        <h2>快取管理</h2>
        <div id="cache-stats" class="cache-stats">
          <div class="stat-item">
            <span class="stat-label">已快取</span>
            <span id="cache-count" class="stat-value">0 筆翻譯</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">使用空間</span>
            <span id="cache-size" class="stat-value">0 B</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">命中率</span>
            <span id="cache-hit-rate" class="stat-value">0%</span>
          </div>
        </div>
        <div class="cache-actions">
          <button id="refresh-cache-stats" class="btn btn-secondary">重新整理</button>
          <button id="clear-cache" class="btn btn-danger">清除所有快取</button>
        </div>
        <div id="cache-entries" class="cache-entries">
          <h3>快取列表</h3>
          <div id="cache-entries-list" class="cache-entries-list">
            <div class="empty-state">載入中...</div>
          </div>
        </div>
      </section>

      <div class="actions">
        <button id="save-settings" class="btn btn-primary">儲存設定</button>
      </div>
    </main>
  </div>
  <script src="options.js"></script>
</body>
</html>
